# CarND Path Planning Project
Michael P. Scherer

## State Manager

High level behaviors are dictated by a state manager.

### States

#### Stay In Lane

Stay in the current lane. The car is held in this state for a minimum of 5 seconds to reduce unexpected behavior from the perspective of other drivers. First the algorithm decides how badly it wants to change lanes. To determine this, two values are generated: a desirability to stay in the current lane, and a desirability to change lanes. These values are each normalized to be between [0,1]. The desirability to stay in lane is fixed to a value of 0.5. The desirability is a function of the car's speed as a fraction of the target speed. The farther the car's speed from the target speed, the more the car will desire changing lanes. The desirability to change lanes is given by the following:

	tanh(4.0 - 4.0 * (min(TARGET_SPEED, car_.speed) / TARGET_SPEED))

The hyperbolic tangent, which starts with tanh(0) == 0 and approaches 1 tangentially, was chosen both because it normalizes the value and because it ramps quickly. This fast ramping means that a small drop in speed from the target speed will result in a larger desirability to change lanes. This input value is multiplied by 4 as a gain which was tuned manually to get a driving experience that "felt right".

If the desirability to change is greater than the desirability to stay by at least a margin of 0.1, it then transitions to either begin a left or right lane change if traffic in the current lane is slower than one of the adjacent lanes.

#### Begin Left Lane Change

Matches speeds with the car in the left lane in order to prepare for a lane change, while still balancing the speed with the one in front of it. When a large enough gap is present, the system transitions to the left lane change state. The car may abandon this maneuver while in this state and continue staying in the current lane if it finds that the current lane is faster and it takes too long to change lanes.

#### Left Lane Change

Actually commits to a left lane change.

#### Begin Right Lane Change

Same as begin left lane change, but for right lane changes.

#### Right Lane Change

Same as begin left lane change, but for right lane changes.

## World Model

Information on the surrounding world is stored in the world model. The world model calculates the acceleration of the targets fed into it based on successive speed updates. The model for the targets currently assumes they will stay in the same lane, continuing at their current speed and acceleration.

## Trajectory Planner (Path Generation)

Candidate trajectories are generated by first filling in a small number of points from the previous path for continuity.

Waypoints are chosen in Frenet coordinates which extend in front of the car either in the current lane (constant d) or to an adjacent lane as required (linearly increasing d). The waypoints are chosen with a spacing of 15 units in s. The car's current position is then taken to build a vehicle-centric coordinate system. Each waypoint is converted to global x-y, and then subsequently into the vehicle space. The waypoints are then used to construct a spline to create a smooth path through space.

The smooth path is then taken, and a model of speed along X is used to ramp the speed up along the path at the target acceleration rate of 5 m/s/s, assuming a fixed time interval of 0.01s. In other words, choosing points along the spline dictates the speed because the time duration between each point is fixed at 0.01s. The points are then transformed into global x-y space and added to the candidate trajectory.

Candidate safety is determined by verifying both that it stays on the road and that the path does not collide with any other vehicle.

